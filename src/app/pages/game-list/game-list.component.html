<div class="header-row">
  <div class="header-top">
    <button mat-icon-button routerLink="/home" aria-label="Go back">
      <mat-icon>arrow_back</mat-icon>
    </button>

    <div class="summary">
      <span><strong>Total:</strong> {{ filteredGames().length }} games</span>
      <span><strong>Spent:</strong> {{ getTotalPrice() | currency: 'EUR' }}</span>
    </div>
  </div>

  <div class="filters">
    <mat-form-field appearance="outline">
      <mat-label>Search by Title</mat-label>
      <input matInput [value]="searchTerm()" (input)="onSearchInput($event)" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Filter by Console</mat-label>
      <mat-select [value]="selectedConsole" (selectionChange)="selectedConsole.set($event.value)">
        <mat-option value="">All</mat-option>
        @for (c of consoles; track c.code) {
          <mat-option [value]="c.code">{{ c.labelKey | transloco }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>
</div>

<div class="list-container">
  <div class="card-grid">
    @for (game of paginatedGames(); track game.id) {
      <app-game-card [game]="game" (gameDeleted)="onGameDeleted($event)"></app-game-card>
    }
  </div>

  @if (filteredGames().length > pageSize()) {
    <div class="pagination">
      <mat-form-field appearance="outline" class="page-size-select">
        <mat-label>Items per page</mat-label>
        <mat-select [value]="pageSize()" (selectionChange)="pageSize.set($event.value)">
          @for (size of [12, 24, 48]; track size) {
            <mat-option [value]="size">{{ size }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <button mat-button (click)="setPage(page() - 1)" [disabled]="page() === 0">
        <mat-icon>chevron_left</mat-icon>
      </button>

      <span class="page-info"> Page {{ page() + 1 }} of {{ totalPages() }} </span>

      <button mat-button (click)="setPage(page() + 1)" [disabled]="(page() + 1) * pageSize() >= filteredGames().length">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
  }

  @if (filteredGames().length === 0) {
    <p class="no-games">No games found.</p>
  }
</div>
